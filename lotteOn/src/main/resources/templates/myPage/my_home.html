<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" as="style" crossorigin
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"/>
    <link rel="stylesheet" href="/style/mypage/my_home.css">
    <link rel="stylesheet" href="/style/mypage/my_home_modal.css">
    <link rel="stylesheet" href="/style/common/_header.css">
    <link rel="stylesheet" href="/style/common/_footer.css">
    <link rel="stylesheet" href="/style/mypage/myPages.css">

    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="/script/swiper3.js"></script>

    <!-- Script -->
    <script src="/script/search.js"></script>
    <script src="/script/myPointComma.js"></script>

    <!-- Favicon -->
    <link rel="icon" sizes="32x32" th:href="@{'/images/config/' + ${config.favicon}}">

    <title>마이페이지 : 롯데ON</title>
    <style>
        .rating {
            display: inline-block;
        }

        .star {
            font-size: 30px;
            color: #ccc; /* 기본 회색 */
            cursor: pointer;
        }

        .star.selected {
            color: #f39c12; /* 선택된 별은 노란색 */
        }

        .star:hover {
            color: #f39c12; /* 호버 시 노란색 */
        }
    </style>
</head>
<body>
<div id="container">
    <th:block th:include="/common/_header.html"/>
    <main>
        <div class="mainWrapper">
            <div class="mainContainer">
                <aside>
                    <h2>마이롯데</h2>
                    <div class="asideLink">
                        <a th:href="@{/myPage/my_order}">주문 내역</a>
                        <a th:href="@{/myPage/my_point}">포인트 내역</a>
                        <a th:href="@{/myPage/my_coupon}">쿠폰</a>
                        <a th:href="@{/myPage/my_review}">나의 리뷰</a>
                        <a th:href="@{/myPage/my_qna}">문의 내역</a>
                        <a th:href="@{/myPage/my_qna_product}">상품 문의</a>
                        <a th:href="@{/myPage/my_info}">나의 설정</a>
                    </div>
                    <div class="customerService">
                        <p>롯데ON 고객센터</p>
                        <div>
                            <h4>1899-7000</h4>
                        </div>
                        <p>월~금요일 09:00 ~ 18:00</p>
                        <p>주말, 공휴일 휴무</p>
                    </div>
                    <div class="asideBtn">
                        <a th:href="@{/cust/cust_main}">
                            <button>고객센터</button>
                        </a>
                        <a href="#">
                            <button>문의하기</button>
                        </a>
                    </div>
                </aside>
                <section>
                    <div class="simpleInfoWrapper">
                        <div class="simpleInfo">
                            <div>
                                <p>쇼핑하기 좋은 날이에요!</p>
                                <a th:href="@{/myPage/my_info}" class="nameBox">
                                    <p class="bold" th:text="${loginUser.name}"></p>
                                    <p>님</p>
                                </a>
                                <div class="ratingBox">
                                    <img src="/images/icon_mylotte.png" alt="등급">
                                    <p class="bold">롯데ON</p>
                                    <p class="bold" th:text="${loginUser.rating}"></p>
                                    <p>등급이네요!</p>
                                </div>
                            </div>
                            <div>
                                <div class="myPoint">
                                    <a th:href="@{/myPage/my_order}">
                                        <p>주문 수</p>
                                        <div>
                                            <p class="bold" th:text="${totalOrder}"></p>
                                            <p>건</p>
                                        </div>
                                    </a>
                                </div>
                                <div class="myPoint">
                                    <a th:href="@{/myPage/my_point}">
                                        <p>POINT</p>
                                        <div>
                                            <p class="bold thisIsMyPoint" th:text="${totalPointCount}"></p>
                                            <p>P</p>
                                        </div>
                                    </a>
                                </div>
                                <div class="myCoupon">
                                    <a th:href="@{/myPage/my_coupon}">
                                        <p>나의 쿠폰</p>
                                        <div>
                                            <p class="bold" th:text="${totalCoupon}"></p>
                                            <p>개</p>
                                        </div>
                                    </a>
                                </div>
                                <div class="myReview">
                                    <a th:href="@{/myPage/my_qna}">
                                        <p>문의 수</p>
                                        <div>
                                            <p class="bold" th:text="${totalQnaCount}"></p>
                                            <p>개</p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="simpleInfoFooter">
                            <div class="swiper">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide">롯데ON에 오신 것을 환영합니다!</div>
                                    <div class="swiper-slide">오늘도 행복한 하루 보내세요!</div>
                                    <div class="swiper-slide">롯데6차 수강생들 프로젝트 화이팅! 💪</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="recentOrder var">
                        <div class="varTitle">
                            <h3>최근 주문 내역</h3>
                            <a th:href="@{/myPage/my_order}" class="allView" >전체보기</a>
                        </div>
                        <div class="orderHeader" th:if="${#lists.isEmpty(recentOrder)}">
                            <div>
                                <p>최근 주문한 내역이 없습니다.</p>
                            </div>
                        </div>
                        <div class="orderList" th:each="order, i : ${recentOrder}">
                            <div class="orderHeader">
                                <div>
                                    <p class="orderDate" th:text="${order.orderDate}">2025.05.09</p>
                                    <p class="orderNo" th:text="${order.orderCode}" th:onclick="'showPopup(' + ${i.index} + ')'"></p>
                                </div>
                                <a href="#" class="detailView" th:onclick="'showPopup(' + ${i.index} + ')'">상세보기</a>
                            </div>
                            <div class="orderItem">
                                <div class="itemDetail">
                                    <div class="itemImg">
                                        <img th:src="@{'/images/' + ${order.imageList}}" alt="주문한 상품 이미지">
                                    </div>
                                    <div class="itemInfo">
                                        <div class="itemTitle">
                                            <a href="#" class="itemCompany" th:text="${order.companyName}" th:onclick="'showCompanyPopup(' + ${i.index} + ')'">맛있는소고기</a>
                                            <p class="itemName" th:text="${order.productName}"></p>
                                        </div>
                                        <div class="itemOption">
                                            <p th:text="${order.description}"></p>
                                        </div>
                                        <div class="itemPrice">
                                            <h4 th:text="${order.price}" class="thisIsMyPoint"></h4>
                                            <p>원</p>
                                            <div class="v-l"></div>
                                            <span>수량 [[${order.quantity}]]</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="orderManagement">
                                    <div class="orderStatus">
                                        <h4 th:text="${order.orderStatus}">구매확정</h4>
                                        <p>을(를) 했습니다.</p>
                                    </div>
                                    <div class="orderButtons">
                                        <a href="#">
                                            <button th:onclick="'showConfirmPopup(' + ${i.index} + ')'">구매확정</button>
                                        </a>
                                        <a href="#">
                                            <button th:onclick="'showReviewPopup(' + ${i.index} + ')'">리뷰쓰기</button>
                                        </a>
                                        <a href="#">
                                            <button th:onclick="'showRefundPopup(' + ${i.index} + ')'">반품신청</button>
                                        </a>
                                        <a href="#">
                                            <button th:onclick="'showExchangePopup(' + ${i.index} + ')'">교환신청</button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pointHistory var">
                        <div class="varTitle">
                            <h3>포인트 적립 내역</h3>
                            <a th:href="@{/myPage/my_point}" class="allView">전체보기</a>
                        </div>
                        <div class="orderHeader" th:if="${#lists.isEmpty(recentPoint)}">
                            <div>
                                <p>적립한 포인트가 없습니다.</p>
                            </div>
                        </div>
                        <div class="pointList">
                            <table>
                                <tr>
                                    <th>적립일</th>
                                    <th>구분</th>
                                    <th>적립 포인트</th>
                                    <th>적립 코드</th>
                                    <th>적립 내용</th>
                                </tr>
                                <tr th:each="point : ${recentPoint}">
                                    <td th:text="${point.giveDate}"></td>
                                    <td th:text="${point.givePoint > 0 ? '적립' : (point.givePoint < 0 ? '차감' : '0') }"></td>
                                    <td th:text="${point.givePoint}" class="thisIsMyPoint savePoints"></td>
                                    <td th:text="${point.orderCode}"></td>
                                    <td th:text="${point.giveContent}"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="myReviewList var">
                        <div class="varTitle">
                            <h3>나의 리뷰</h3>
                            <a th:href="@{/myPage/my_review}" class="allView">전체보기</a>
                        </div>
                        <div class="orderHeader" th:if="${#lists.isEmpty(recentReview)}">
                            <div>
                                <p>작성한 리뷰가 없습니다.</p>
                            </div>
                        </div>
                        <div class="reviewList" th:each="review, i : ${recentReview}">
                            <table>
                                <tr>
                                    <th>번호</th>
                                    <th>상품명</th>
                                    <th>제목</th>
                                    <th>내용</th>
                                    <th>별점</th>
                                    <th>작성일</th>
                                </tr>
                                <tr>
                                    <td th:text="${review.reviewNo}">1</td>
                                    <td th:text="${review.productName}">한우 1++ 1kg</td>
                                    <td th:text="${review.title}">한우 맞나요?</td>
                                    <td th:text="${review.content}">한우 맞나요? 그짓말 하시는거죠? 호주산이잖아횽!</td>
                                    <td th:text="${review.rating}">⭐⭐⭐⭐⭐</td>
                                    <td th:text="${review.regDate}">2025.05.08</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="customerCenter var">
                        <div class="varTitle">
                            <h3>고객 문의</h3>
                            <a th:href="@{/myPage/my_qna}" class="allView">전체보기</a>
                        </div>
                        <div class="orderHeader" th:if="${recentQna == null or #lists.isEmpty(recentQna)}">
                            <div>
                                <p>등록된 문의가 없습니다.</p>
                            </div>
                        </div>
                        <div class="helpList">
                            <table>
                                <tr>
                                    <th>번호</th>
                                    <th>채널</th>
                                    <th>유형</th>
                                    <th>제목</th>
                                    <th>작성일</th>
                                    <th>상태</th>
                                </tr>
                                <tr th:each="qna : ${recentQna}">
                                    <td th:text="${qna.qnaNo}">1</td>
                                    <td th:text="${qna.channel}">고객센터</td>
                                    <td th:text="${qna.cate2}">반품신청/철회</td>
                                    <td th:text="${qna.title}">소고기가 너무 맛이가 없자나 응?</td>
                                    <td th:text="${qna.regDate}">2025.05.08</td>
                                    <td th:text="${qna.status}"
                                        th:classappend="${qna.status == '답변완료'} ? ' answered' : ''"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>
    <th:block th:replace="/common/_footer.html :: footerFragment(versionId=${selectedVersionId})"/>
    <!-- ✅ tr 밖에 모달을 따로 위치 -->

    <!-- 주문 상세 모달 -->
    <div th:each="order, i : ${recentOrder}" th:id="'popup-' + ${i.index}" class="popup" style="display:none;">
        <div class="popup-content">
            <h2>주문 상세</h2>
            <div class="info">
                <h3>상품 정보</h3>
                <table>
                    <tr>
                        <th>상품 이미지</th>
                        <th colspan="2">상품 상세정보</th>
                        <th colspan="2">결제 정보</th>
                    </tr>
                    <tr>
                        <td rowspan="6" style="width: 230px; padding: 0">
                            <img th:src="@{'/images/' + ${order.imageList}}" alt="#" class="main_img1">
                        </td>
                        <th>주문 번호</th>
                        <td>[[${order.orderCode}]]</td>
                        <th>금액</th>
                        <td>[[${order.price}]]원</td>
                    </tr>
                    <tr>
                        <th>판매자</th>
                        <td>[[${order.companyName}]]</td>
                        <th>할인</th>
                        <td>[[${order.discount}]]원</td>
                    </tr>
                    <tr>
                        <th>주문일</th>
                        <td>[[${order.orderDate}]]</td>
                        <th>결제</th>
                        <td>[[${order.actualMoney}]]원</td>
                    </tr>
                    <tr>
                        <th>상품명</th>
                        <td>[[${order.productName}]]</td>
                        <th>배송비</th>
                        <td>[[${order.fee}]]원</td>
                    </tr>
                    <tr>
                        <th>수량</th>
                        <td>[[${order.quantity}]]</td>
                        <th>결제수단</th>
                        <td>[[${order.payment}]]</td>
                    </tr>
                    <tr>
                        <th>금액</th>
                        <td>[[${order.price}]]원</td>
                    </tr>
                </table>
                <h3>배송 정보</h3>
                <table>
                    <tr>
                        <th>배송상태</th>
                        <td>[[${order.orderStatus}]]</td>
                    </tr>
                    <tr>
                        <th>이름</th>
                        <td>[[${order.receiver}]]</td>
                    </tr>
                    <tr>
                        <th>주소</th>
                        <td>[[${order.delivery}]]</td>
                    </tr>
                </table>
            </div>
            <button th:onclick="'closePopup(' + ${i.index} + ')'">닫기</button>
        </div>
    </div>

    <!-- 회사 정보 모달 -->
    <div th:each="seller, i : ${recentOrder}" th:id="'company-popup-' + ${i.index}" class="popup" style="display:none;">
        <div class="popup-content">
            <h2>회사 정보</h2>
            <div class="info_company">
                <h3>회사 정보</h3>
                <table>
                    <tr>
                        <th>판매자 등급</th>
                        <td>[[${seller.rating}]]</td>
                    </tr>
                    <tr>
                        <th>회사명</th>
                        <td>[[${seller.companyName}]]</td>
                    </tr>
                    <tr>
                        <th>대표자</th>
                        <td>[[${seller.delegate}]]</td>
                    </tr>
                    <tr>
                        <th>전화번호</th>
                        <td>[[${seller.hp}]]</td>
                    </tr>
                    <tr>
                        <th>FAX</th>
                        <td>[[${seller.fax}]]</td>
                    </tr>
                    <tr>
                        <th>사업자번호</th>
                        <td>[[${seller.businessNo}]]</td>
                    </tr>
                    <tr>
                        <th>영업소재지</th>
                        <td><span>[</span>[[${seller.zip}]]<span>]</span> &nbsp;&nbsp;
                            [[${seller.addr1}]], &nbsp;
                            [[${seller.addr2}]]
                        </td>
                    </tr>
                </table>
                <p>* 위 정보는 전자상거래법 제 20조 제 2항 및 동법 시행령 제 25조 제 2항에 의거하여 소비자 보호에 의거 공개합니다.</p>
            </div>
            <button th:onclick="'closePopup(' + ${i.index} + ')'" type="button">닫기</button>
            <button type="button" th:onclick="'showInquiryPopup(' + ${i.index} + ')'">문의하기</button>
        </div>
    </div>

    <!-- 문의하기 모달 -->
    <div th:each="seller, i : ${recentOrder}" th:id="'inquiry-popup-' + ${i.index}" class="popup" style="display:none; width: 700px">
        <div class="popup-content">
            <h2>문의하기</h2>
            <form th:action="@{/myPage/my_seller_qna}" method="post" enctype="multipart/form-data">
                <input type="hidden" name="writer" th:value="${#authentication.principal.member.id}">
                <div class="inquiry_form">
                    <table>
                        <tr>
                            <th>카테고리</th>
                            <td>
                                <select name="cate1">
                                    <option value="product">상품</option>
                                    <option value="delivery">배송</option>
                                    <option value="cancel">반품/취소/교환</option>
                                    <option value="etc">기타</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th>제목</th>
                            <td>
                                <div>
                                    <input type="text" name="title" id="title" placeholder="제목 입력">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>문의내용</th>
                            <td>
                                <div>
                                    <textarea name="content" id="content" placeholder="문의내용 작성"></textarea>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <button type="submit">문의하기</button>
            </form>
            <button th:onclick="'closePopup(' + ${i.index} + ')'">닫기</button>
        </div>
    </div>

    <!-- 구매확정 모달 -->
    <div th:each="order, i : ${recentOrder}" th:id="'confirm-popup-' + ${i.index}" class="popup" style="display: none; width: 400px">
        <div class="popup-content">
            <h2>구매확정</h2>
            <form action="/myPage/my_confirm" method="post">
                <input type="hidden" name="orderCode" th:value="${order.orderCode}">
                <div class="confirm_message">
                    <div class="alert_message">
                        <p>상품을 받으셨나요?</p>
                        <p>상품을 받으신 분만 구매확정을 해주세요.</p>
                        <p style="text-decoration: underline; font-weight: bold">구매 확정 후에는 반품 또는 교환이 어렵습니다.</p>
                    </div>
                    <div class="confirm_button">
                        <button type="submit">확인</button>
                    </div>
                </div>
            </form>
            <button th:onclick="'closePopup(' + ${i.index} + ')'" style="background-color: #8B0000">취소</button>
        </div>
    </div>

    <!--상품평쓰기 모달-->
    <div th:each="order, i : ${recentOrder}" th:id="'review-popup-' + ${i.index}" class="popup" style="display:none; width: 700px">
        <div class="popup-content">
            <h2>상품평</h2>
            <form action="/myPage/my_review_write" method="post" enctype="multipart/form-data">
                <input type="hidden" name="productCode" th:value="${order.productCode}">
                <input type="hidden" name="writer" th:value="${#authentication.principal.member.id}"/>
                <div class="review_form">
                    <h3>리뷰 작성하기</h3>
                    <table>
                        <tr>
                            <th>상품명</th>
                            <td>[[${order.productName}]]</td>
                        </tr>
                        <tr>
                            <th>만족도</th>
                            <td>
                                <div class="rating">
                                    <span class="star" data-value="1">&#9733;</span>
                                    <span class="star" data-value="2">&#9733;</span>
                                    <span class="star" data-value="3">&#9733;</span>
                                    <span class="star" data-value="4">&#9733;</span>
                                    <span class="star" data-value="5">&#9733;</span>
                                </div>
                                <input type="hidden" name="rating" id="rating">
                            </td>
                        </tr>
                        <tr>
                            <th>제목</th>
                            <td>
                                <input type="text" name="title" placeholder="제목 입력">
                            </td>
                        </tr>
                        <tr>
                            <th>내용</th>
                            <td>
                                <textarea name="content" placeholder="내용 입력"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <th>사진</th>
                            <td>
                                <div>
                                    <input type="file" name="imageList1" placeholder="선택된 파일 없음">
                                </div>
                                <div>
                                    <input type="file" name="imageList2" placeholder="선택된 파일 없음">
                                </div>
                                <div>
                                    <input type="file" name="imageList3" placeholder="선택된 파일 없음">
                                </div>
                            </td>
                        </tr>
                    </table>
                    <div class="review_button">
                        <button type="submit" class="review_btn1">작성완료</button>
                    </div>
                </div>
            </form>
            <button th:onclick="'closePopup(' + ${i.index} + ')'" class="review_btn2">취소</button>
        </div>
    </div>

    <!--반품신청 모달-->
    <div th:each="order, i : ${recentOrder}" th:id="'refund-popup-' + ${i.index}" class="popup" style="display: none; width: 700px">
        <div class="popup-content">
            <h2>반품신청</h2>
            <form action="/myPage/my_refund" method="post">
                <input type="hidden" name="writer" th:value="${#authentication.principal.member.id}">
                <div class="product_info">
                    <h3>상품 정보</h3>
                    <table>
                        <tr>
                            <th>주문 번호</th>
                            <td>[[${order.orderCode}]]</td>
                            <th>주문일</th>
                            <td>[[${order.orderDate}]]</td>
                        </tr>
                        <tr>
                            <th>판매자</th>
                            <td>[[${order.companyName}]]</td>
                            <th>상품</th>
                            <td>[[${order.productName}]]&nbsp;/&nbsp;[[${order.quantity}]]개</td>
                        </tr>
                        <tr>
                            <th>결제금액</th>
                            <td>[[${order.actualMoney}]]원</td>
                            <th>배송비</th>
                            <td>[[${order.fee}]]원</td>
                        </tr>
                        <tr>
                            <th>결제수단</th>
                            <td>[[${order.payment}]]</td>
                            <th>최종 반품금액</th>
                            <td>-[[${order.actualMoney}]]원</td>
                        </tr>
                    </table>
                </div>
                <div class="refund_info">
                    <h3>반품 정보 입력</h3>
                    <table class="refund">
                        <tr>
                            <th>주문번호</th>
                            <td>
                                <input type="text" readonly name="orderCode" th:value="${order.orderCode}">

                            </td>
                        </tr>
                        <tr>
                            <th>반품 유형</th>
                            <td>
                                <div class="radio">
                                    불량/파손<input type="radio" name="returnType" value="broken">
                                    단순변심<input type="radio" name="returnType" value="dislike">
                                    주문실수<input type="radio" name="returnType" value="misorder">
                                    오배송<input type="radio" name="returnType" value="misdelivery">
                                    배송지연<input type="radio" name="returnType" value="delay">
                                    상품정보 상이<input type="radio" name="returnType" value="misinfo">
                                    기타<input type="radio" name="returnType" value="etc">
                                </div>
                                <p>개인 변심이나 주문 실수로 인한 반품 배송비는 고객 부담입니다.</p>
                            </td>
                        </tr>
                        <tr>
                            <th colspan="4">반품 사유(자세히)</th>
                            <td>
                                <textarea type="text" name="reason"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <th>사진</th>
                            <td>
                                <div>
                                    <input type="file" name="imageList1" placeholder="선택된 파일 없음">
                                </div>
                                <div>
                                    <input type="file" name="imageList2" placeholder="선택된 파일 없음">
                                </div>
                                <div>
                                    <input type="file" name="imageList3" placeholder="선택된 파일 없음">
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="confirm_button">
                    <button type="submit">반품신청</button>
                </div>
            </form>
            <button th:onclick="'closePopup(' + ${i.index} + ')'" style="background-color: #8B0000">취소</button>
        </div>
    </div>

    <!--교환신청 모달-->
    <div th:each="order, i : ${recentOrder}" th:id="'exchange-popup-' + ${i.index}" class="popup" style="display: none; width: 700px">
    <div class="popup-content">
        <h2>교환신청</h2>
        <form action="/myPage/my_exchange" method="post">
            <input type="hidden" name="writer" th:value="${#authentication.principal.member.id}">
            <div class="product_info">
                <h3>상품 정보</h3>
                <table>
                    <tr>
                        <th>주문 번호</th>
                        <td>[[${order.orderCode}]]</td>
                        <th>주문일</th>
                        <td>[[${order.orderDate}]]</td>
                    </tr>
                    <tr>
                        <th>판매자</th>
                        <td>[[${order.companyName}]]</td>
                        <th>상품</th>
                        <td>[[${order.productName}]]&nbsp;/&nbsp;[[${order.quantity}]]개</td>
                    </tr>
                    <tr>
                        <th>결제금액</th>
                        <td>[[${order.actualMoney}]]원</td>
                        <th>배송비</th>
                        <td>[[${order.fee}]]원</td>
                    </tr>
                    <tr>
                        <th>결제수단</th>
                        <td>[[${order.payment}]]</td>
                        <th>최종 반품금액</th>
                        <td>-[[${order.actualMoney}]]원</td>
                    </tr>
                </table>
            </div>
            <div class="refund_info">
                <h3>반품 정보 입력</h3>
                <table class="refund">
                    <tr>
                        <th>주문번호</th>
                        <td>
                            <input type="text" readonly name="orderCode" th:value="${order.orderCode}">

                        </td>
                    </tr>
                    <tr>
                        <th>교환 유형</th>
                        <td>
                            <div class="radio">
                                불량/파손<input type="radio" name="exchangeType" value="broken">
                                오배송<input type="radio" name="exchangeType" value="misdelivery">
                                사이즈<input type="radio" name="exchangeType" value="size">
                                상품정보 상이<input type="radio" name="exchangeType" value="misinfo">
                                기타<input type="radio" name="exchangeType" value="etc">
                            </div>
                            <p>개인 변심이나 주문 실수로 인한 반품 배송비는 고객 부담입니다.</p>
                        </td>
                    </tr>
                    <tr>
                        <th colspan="4">교환 사유(자세히)</th>
                        <td>
                            <textarea type="text" name="reason"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <th>사진</th>
                        <td>
                            <div>
                                <input type="file" name="imageList1" placeholder="선택된 파일 없음">
                            </div>
                            <div>
                                <input type="file" name="imageList2" placeholder="선택된 파일 없음">
                            </div>
                            <div>
                                <input type="file" name="imageList3" placeholder="선택된 파일 없음">
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="confirm_button">
                <button type="submit">교환신청</button>
            </div>
        </form>
        <button th:onclick="'closePopup(' + ${i.index} + ')'" style="background-color: #8B0000">취소</button>
    </div>
</div>

    <script th:inline="javascript">
        //상품정보
        function showPopup(index) {
            document.getElementById("popup-" + index).style.display = "block";
        }

        //회사정보
        function showCompanyPopup(index) {
            document.getElementById("company-popup-" + index).style.display = "block";
        }

        //문의하기
        function showInquiryPopup(index) {
            // 회사정보 모달 닫기
            document.getElementById("company-popup-" + index).style.display = "none";
            // 문의하기 모달 열기
            document.getElementById("inquiry-popup-" + index).style.display = "block";
        }

        //상품확정
        function showConfirmPopup(index) {
            document.getElementById("confirm-popup-" + index).style.display = "block";
        }

        //상품평
        function showReviewPopup(index) {
            document.getElementById("review-popup-" + index).style.display = "block";
        }

        //반품신청
        function showRefundPopup(index) {
            document.getElementById("refund-popup-" + index).style.display = "block";
        }

        //교환신청
        function showExchangePopup(index) {
            document.getElementById("exchange-popup-" + index).style.display = "block";
        }

        // 모달 닫기
        function closePopup(index) {
            document.getElementById("popup-" + index).style.display = "none";
            document.getElementById("company-popup-" + index).style.display = "none";
            document.getElementById("inquiry-popup-" + index).style.display = "none";
            document.getElementById("confirm-popup-" + index).style.display = "none";
            document.getElementById("review-popup-" + index).style.display = "none";
            document.getElementById("refund-popup-" + index).style.display = "none";
            document.getElementById("exchange-popup-" + index).style.display = "none";
        }

        document.addEventListener("DOMContentLoaded", function() {
            const stars = document.querySelectorAll(".star");
            const ratingInput = document.getElementById("rating");

            stars.forEach(star => {
                star.addEventListener("click", function() {
                    const value = this.getAttribute("data-value");
                    const reviewForm = this.closest(".review_form"); // 이 별이 속한 리뷰 영역
                    const ratingInput = reviewForm.querySelector("input[name='rating']"); // 해당 폼의 rating input

                    ratingInput.value = value;

                    const allStars = reviewForm.querySelectorAll(".star");
                    allStars.forEach(s => {
                        if (s.getAttribute("data-value") <= value) {
                            s.classList.add("selected");
                        } else {
                            s.classList.remove("selected");
                        }
                    });
                });

                star.addEventListener("mouseover", function() {
                    const value = this.getAttribute("data-value");
                    const reviewForm = this.closest(".review_form");
                    const allStars = reviewForm.querySelectorAll(".star");

                    allStars.forEach(s => {
                        if (s.getAttribute("data-value") <= value) {
                            s.classList.add("selected");
                        } else {
                            s.classList.remove("selected");
                        }
                    });
                });

                star.addEventListener("mouseout", function() {
                    const reviewForm = this.closest(".review_form");
                    const ratingInput = reviewForm.querySelector("input[name='rating']");
                    const value = ratingInput.value;
                    const allStars = reviewForm.querySelectorAll(".star");

                    allStars.forEach(s => {
                        s.classList.remove("selected");
                        if (s.getAttribute("data-value") <= value) {
                            s.classList.add("selected");
                        }
                    });
                });
            });
        });
    </script>
</div>
</body>
</html>