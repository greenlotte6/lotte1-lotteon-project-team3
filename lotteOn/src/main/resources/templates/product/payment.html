<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"/>

    <!-- Favicon -->
    <link rel="icon" sizes="32x32" href="https://static.lotteon.com/p/common/assets/favicon/1/favicon-32.png">

    <!-- Daum Address -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <!-- Script -->
    <script src="/script/search.js"></script>
    <script src="/script/daumPostCode.js"></script>
    <script src="/script/maxLength.js"></script>
    <!--<script src="/script/chooseOption.js"></script>-->
    <script src="/script/selectOne.js"></script>

    <!-- Style -->
    <link rel="stylesheet" href="/style/product/payment.css"/>
    <link rel="stylesheet" href="/style/common/_header.css"/>
    <link rel="stylesheet" href="/style/common/_footer.css"/>
    <title>Î°ØÎç∞ON</title>
    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const chooseBtn = document.querySelector('.chooseBtn');
            const optionsBox = document.querySelector('.chooseOption .options');
            const optionsList = document.querySelector('#couponList');

            // ÎìúÎ°≠Îã§Ïö¥ Ïó¥Í∏∞/Îã´Í∏∞
            chooseBtn.addEventListener('click', () => {
                optionsBox.classList.toggle('active');
            });

            // Ïø†Ìè∞ Î∂àÎü¨Ïò§Í∏∞
            fetch('/product/payment/coupons')
                .then(res => res.json())
                .then(coupons => {
                    console.log('‚úÖ Î∂àÎü¨Ïò® Ïø†Ìè∞:', coupons);
                    optionsList.innerHTML = '';

                    if (!coupons || coupons.length === 0) {
                        optionsList.innerHTML = '<li><p class="couponItem" style="color: gray;">ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïø†Ìè∞ ÏóÜÏùå</p></li>';
                        return;
                    }

                    coupons.forEach(coupon => {
                        const li = document.createElement('li');
                        li.innerHTML = `<p class="couponItem" data-issuedno="${coupon.issuedNo}">
                        ${coupon.couponName} - ${coupon.benefit}
                    </p>`;
                        optionsList.appendChild(li);
                    });
                })
                .catch(err => {
                    console.error('‚ùå Ïø†Ìè∞ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', err);
                });

            // Ïø†Ìè∞ ÌÅ¥Î¶≠ Ïãú ÌÖçÏä§Ìä∏ Î≥ÄÍ≤Ω + ÏΩòÏÜî ÌôïÏù∏
            optionsList.addEventListener('click', (e) => {
                if (e.target.classList.contains('couponItem')) {
                    chooseBtn.textContent = e.target.textContent;
                    const issuedNo = e.target.getAttribute('data-issuedno');
                    console.log('üëâ ÏÑ†ÌÉùÎêú Ïø†Ìè∞ issuedNo:', issuedNo);
                    optionsBox.classList.remove('active');
                }
            });
        });
    </script>
</head>
<body>
<div id="container">
    <th:block th:include="/common/_header.html"/>
    <main>
        <div class="mainContainer">
            <div class="paymentWrapper">
                <h2>Ï£ºÎ¨∏/Í≤∞Ï†ú</h2>
                <div class="paymentContainer">
                    <h3 class="sectionTitle">Ï£ºÎ¨∏ÏÉÅÌíà</h3>
                    <div class="productSectionWrapper">
                        <div class="productSectionContainer">
                            <div class="productSectionWrapper">
                                <div class="productSectionContainer">
                                    <th:block th:each="item : ${items}">
                                        <div class="productSection">
                                            <img th:src="@{'/images/' + ${item.product.imageList}}" alt="ÏÉÅÌíàÏÇ¨ÏßÑ">
                                            <div class="productInfo">
                                                <p class="productTitle" th:text="${item.product.name}"></p>
                                                <p th:text="${item.option}"></p>
                                                <div class="productPrice">
                                                    <span th:text="${#numbers.formatInteger(item.product.price * (100 - item.product.discount) / 100 * item.quantity, 3, 'COMMA')} + 'Ïõê'"></span>
                                                    <del th:text="${#numbers.formatInteger(item.product.price * item.quantity, 3, 'COMMA')} + 'Ïõê'"></del>
                                                    <div class="v-ll"></div>
                                                    <span th:text="${item.quantity} + 'Í∞ú'"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </th:block>
                                </div>
                            </div>
                            <!--
                            <div class="productSection">
                                <img th:src="@{'/images/' + ${product.imageList}}" alt="ÏÉÅÌíàÏÇ¨ÏßÑ">
                                <div class="productInfo">
                                    <p class="productTitle" th:text="${product.name}"></p>
                                    <p th:text="${option}"></p>
                                    <div class="productPrice">
                                        <span th:text="${#numbers.formatInteger(product.price * (100 - product.discount) / 100 * quantity, 3, 'COMMA')} + 'Ïõê'"></span>
                                        <del th:text="${#numbers.formatInteger(product.price * quantity, 3, 'COMMA')} + 'Ïõê'"></del>
                                        <div class="v-ll"></div>
                                        <span th:text="${quantity} + 'Í∞ú'"></span>
                                    </div>
                                </div>
                            </div>
                            -->
                        </div>
                    </div>
                    <form action="#" method="post">
                        <h3 class="sectionTitle">Ï£ºÎ¨∏Ïûê Ï†ïÎ≥¥</h3>
                        <div class="sectionWrapper">
                            <div class="section">
                                <p>ÏàòÎ†πÏûê</p>
                                <input type="text" name="receiver" placeholder="ÏàòÎ†πÏûêÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                            </div>
                            <div class="section">
                                <p>Î≥¥ÎÇ¥Îäî Î∂Ñ</p>
                                <input type="text" name="sender" th:value="${items[0].product.companyName}" readonly>
                            </div>
                            <div class="section">
                                <p>Ìú¥ÎåÄÌè∞</p>
                                <input type="text" name="hp" th:value="${member.hp}" readonly>
                            </div>
                        </div>
                        <h3 class="sectionTitle">Î∞∞ÏÜ°Ï†ïÎ≥¥</h3>
                        <div class="sectionWrapper">
                            <div class="section">
                                <p>Ïö∞Ìé∏Î≤àÌò∏</p>
                                <input type="text" name="zip" th:value="${member.zip}" class="zip" id="postcode"
                                       readonly>
                                <button type="button" onclick="DaumPostcode()" class="findAddress">Ïö∞Ìé∏Î≤àÌò∏ Ï∞æÍ∏∞</button>
                            </div>
                            <div class="section">
                                <p>Í∏∞Î≥∏Ï£ºÏÜå</p>
                                <input type="text" name="addr1" th:value="${member.addr1}" id="address" readonly>
                            </div>
                            <div class="section">
                                <p>ÏÉÅÏÑ∏Ï£ºÏÜå</p>
                                <input type="text" name="addr2" th:value="${member.addr2}" id="detailAddress"
                                       placeholder="ÏÉÅÏÑ∏Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                            </div>
                            <div class="section">
                                <p>Í∏∞ÌÉÄ</p>
                                <input type="text" name="other" class="other" placeholder="Í∏∞ÌÉÄ ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî (ÏµúÎåÄ 25Ïûê)"
                                       maxlength="25">
                            </div>
                        </div>
                    </form>
                    <form action="/product/payment" method="post">
                        <input type="hidden" name="productCode" th:value="${productCode}" />
                        <input type="hidden" name="quantity" th:value="${quantity}" />
                        <input type="hidden" name="option" th:value="${option}" />
                        <div class="AllContainer">
                            <div class="leftContainer">
                                <h3 class="sectionTitle">Ïø†Ìè∞/Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©</h3>
                                <div class="sectionWrapper">
                                    <div class="section3">
                                        <p>ÏûîÏó¨ Ìè¨Ïù∏Ìä∏</p>
                                        <div class="remainPoint">
                                            <p>10002</p>
                                            <p>&nbsp;P</p>
                                        </div>
                                    </div>
                                    <div class="section3">
                                        <p>Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©</p>
                                        <div>
                                            <button type="button" class="usePointBtn">ÏÇ¨Ïö©</button>
                                            <input type="number" placeholder="0" class="point" min="0"></input>
                                        </div>
                                    </div>
                                    <div class="section3">
                                        <p>Ïø†Ìè∞ Ï†ÅÏö©</p>
                                        <div class="chooseOption">
                                            <p class="chooseBtn">ÏÇ¨Ïö©Ìï† Ïø†Ìè∞</p>
                                            <div class="options">
                                                <ul id="couponList">
                                                    <!-- JSÎ°ú liÎì§ Îì§Ïñ¥Ïò¥ -->
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <h3 class="sectionTitle">Í≤∞Ï†úÏàòÎã®</h3>
                                <div class="sectionWrapper marginBottomZero">
                                    <div class="paymentMethod">
                                        <input type="checkbox" onclick="selectOne(this)" name="phone"
                                               class="payment payment-phone">
                                        <input type="checkbox" onclick="selectOne(this)" name="creditCard"
                                               class="payment payment-creditCard">
                                        <input type="checkbox" onclick="selectOne(this)" name="kakaopay"
                                               class="payment payment-kakaoPay">
                                        <input type="checkbox" onclick="selectOne(this)" name="tosspay"
                                               class="payment payment-tossPay">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="rightContainer">
                                    <h3>Ï¥ù Í≤∞Ï†úÍ∏àÏï°</h3>
                                    <div class="sectionWrapper2">
                                        <div class="section4">
                                            <p>Ï¥ù ÏÉÅÌíàÍ∏àÏï°</p>
                                            <div>
                                                <p>42,840</p>
                                                <p>&nbsp;Ïõê</p>
                                            </div>
                                        </div>
                                        <div class="section4">
                                            <p>Î∞∞ÏÜ°ÎπÑ</p>
                                            <div>
                                                <p>0</p>
                                                <p>&nbsp;Ïõê</p>
                                            </div>
                                        </div>
                                        <div class="section4">
                                            <p>Ìï†Ïù∏Í∏àÏï°</p>
                                            <div>
                                                <p>0</p>
                                                <p>&nbsp;Ïõê</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="totalPrice">
                                        <div>
                                            <p>Ï¥ù</p>
                                            <p class="totalCount">2</p>
                                            <p>Í±¥</p>
                                        </div>
                                        <p class="themeColor">42,820</p>
                                    </div>
                                </div>
                                <button type="button" class="payingBtn"
                                        onclick="location.href='/product/completeOrder'">Í≤∞Ï†úÌïòÍ∏∞
                                </button> <!-- Í∏∞Îä• Íµ¨ÌòÑÌï† Îïå submitÏúºÎ°ú Î≥ÄÍ≤Ω -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
    <th:block th:replace="/common/_footer.html :: footerFragment(versionId=${selectedVersionId})"/>
</div>
</body>
</html>